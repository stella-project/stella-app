version: '3'
services:
    web:
        build: ./app
        volumes:
          - /var/run/docker.sock/:/var/run/docker.sock
          - ./app/log:/app/log
        ports:
            - "80:80"
        depends_on:
          - elastic
          - elastic-external
          - recomm-sample

    elastic:
        build: ./elastic
        container_name: elastic
        volumes:
          - ./data/:/data/

    elastic-external:
        build: https://github.com/stella-project/stella-elastic.git
        container_name: elastic-external
        volumes:
          - ./data/:/data/

    recomm-sample:
        build: ./recomm-sample
        container_name: recomm-sample
        volumes:
          - ./data:/data
        tty: true

# DEPRECATED: Not compatible with new data structure
#    solr:
#      image: solr
#      container_name: solr
#      volumes:
#        - ~/data/sample/:/opt/solr/collection/
#        - ./solr/script/:/script/
#        # - ./solr/init/:/docker-entrypoint-initdb.d/
#      ports:
#        - "8983:8983"

# DEPRECATED: Not compatible with new data structure
#    solr:
#      build: https://github.com/stella-project/solr-docker.git
#      container_name: solr
#      volumes:
#        - ~/data/sample/:/data/

# DEPRECATED: Not compatible with new data structure
#    lucene:
#      image: openjdk
#      container_name: lucene
#      command: tail -F anything
#      volumes:
#        - ~/data/sample/:/data/
#        - ./lucene/:/lucene/
#        - ./lucene/script/:/script/

# DEPRECATED: Not compatible with new data structure
#    lucene:
#      build: https://github.com/stella-project/lucene-ranker-docker.git
#      container_name: lucene
#      volumes:
#        - ~/data/sample/:/data/

# DEPRECATED: Not compatible with new data structure
#    livivo-solr:
#      build: ./livivo_solr_template
#      container_name: livivo-solr